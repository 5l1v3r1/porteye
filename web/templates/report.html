<!DOCTYPE html>
<html lang="en">
  
{% include 'header.html' %}
  
  <body class="">

    {% include 'left.html' %}

 
			<div class="main-content">


				<div class="page-content">


					<div class="row">

						<div class="col-xs-12">
							<!-- PAGE CONTENT BEGINS -->
							<div class="alert alert-info">
								<i class="icon-hand-right"></i> 项目信息
							</div>
							<div class="form-horizontal" id="policy-form"
								style="display: block;">
								<div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span> 项目名称：
									</label>
									<div class="col-sm-7">
										<input type="text" id="name"  readonly="true" 
											class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-required">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span> 域名：
									</label>
									<div class="col-sm-7">
										<input type="text" id="domain"  readonly="true" 
											class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-required"
											>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span> 端口号：
									</label>
									<div class="col-sm-7">
										<span class="block input-icon input-icon-right"> <input  readonly="true" 
											id="port" value="433"
											class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-required"
											ng-model="appidInfo.appname_zh" placeholder="">
										</span>
									</div>
								</div>

								<div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span> 检测频率:
									</label>
									<div class="col-sm-7"> 
											<input readonly="true" type="text" id="frequency"
											class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-required">
									</div>


								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span>通知规则:
									</label>
									<div class="col-sm-7">  
										<input readonly="true" type="text" id="notify_name"
											class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-required">
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span>扩展检测:
									</label>
									 
                                    <div class="col-sm-7">
										<label> <input  disabled="disabled"  id="ccs" value="ccs"
											type="checkbox" class="ace"> <span class="lbl">
												CCS检测</span>
										</label> 
									 

										<label> <input disabled="disabled" id="hsts" value="hsts"
											type="checkbox" class="ace"> <span class="lbl">
												HSTS检测</span>
										</label>  

										<label> <input disabled="disabled" id="heartbleed" value="heartbleed"
											type="checkbox" class="ace"> <span class="lbl">
												HeartBleed检测</span>
										</label>									
											<label> <input disabled="disabled" id="poodle" value="poodle"
											type="checkbox" class="ace"> <span class="lbl">
												 Poodle检测</span>
										</label>
								 	</div>
								</div><div class="form-group">
									<label class="col-sm-2 control-label"> <span
										class="require_text">*</span>状态:
									</label>
									<div class="col-sm-7">  
										<input readonly="true" type="text" id="status"
											class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-required">
									</div>
								</div>

								<h3 class="apply_title"></h3>
								
								<div class="hr hr16 hr-dotted"></div>
								<div class="col-sm-12">
										<div class="tabbable">
											<ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab4">
												<li class="active">
													<a class="btn-success" id="normal_title"  data-toggle="tab" href="#normal">正常</a>
												</li>

												<li>
													<a class="btn-yellow" id="warning_title"  data-toggle="tab" href="#warning">告警</a>
												</li>

												<li>
													<a class="btn-danger" id="error_title"   data-toggle="tab" href="#error">异常</a>
												</li>
											</ul>

											<div class="tab-content">
												<div id="normal" class="tab-pane in active">
												
												</div>

												<div id="warning" class="tab-pane">
												</div>

												<div id="error" class="tab-pane">
												
												</div>
											</div>
										</div>
									</div>
					

							</div>

							<!-- PAGE CONTENT ENDS -->
						</div>
						<!-- /.col -->

					</div>
					<!-- /row -->

					<!-- PAGE CONTENT ENDS -->
				</div>
				<!-- /.col -->
			</div>
			<!-- /.row -->
		</div>
		<!-- /.page-content -->
	</div>
	<!-- /.main-content -->


	</div>
	<!-- /.main-container-inner -->

	<a href="#" id="btn-scroll-up"
		class="btn-scroll-up btn btn-sm btn-inverse"> <i
		class="icon-double-angle-up icon-only bigger-110"></i>
	</a>
	</div>
	<!-- /.main-container -->

	<!-- basic scripts -->
	<!--[if !IE]> -->

	<script
		src="/static/js/google/jquery.min.js"></script>

	<!-- <![endif]-->

	<!--[if IE]>
<script src="/static/js/google/jquery.min.1.10.2.js"></script>
<![endif]-->

	<!--[if !IE]> -->

	<script type="text/javascript">
		window.jQuery
				|| document
						.write("<script src='/static/js/jquery-2.0.3.min.js'>"
								+ "<"+"/script>");
	</script>

	<!-- <![endif]-->

	<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='/static/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

	<script type="text/javascript">
		if ("ontouchend" in document)
			document
					.write("<script src='/static/js/jquery.mobile.custom.min.js'>"
							+ "<"+"/script>");
	</script>
	<script src="/static/js/bootstrap.min.js"></script>
	<script src="/static/js/typeahead-bs2.min.js"></script>

	<!-- page specific plugin scripts -->

	<script src="/static/js/date-time/bootstrap-datepicker.min.js"></script>
	<script src="/static/js/jqGrid/jquery.jqGrid.min.js"></script>
	<script src="/static/js/jqGrid/i18n/grid.locale-en.js"></script>

	<!-- ace scripts -->

	<script src="/static/js/jquery-ui-1.10.3.custom.min.js"></script>
	<script src="/static/js/jquery.ui.touch-punch.min.js"></script>
	<script src="/static/js/jquery.slimscroll.min.js"></script>
	<script src="/static/js/jquery.easy-pie-chart.min.js"></script>
	<script src="/static/js/jquery.sparkline.min.js"></script>
	<script src="/static/js/flot/jquery.flot.min.js"></script>
	<script src="/static/js/flot/jquery.flot.pie.min.js"></script>
	<script src="/static/js/flot/jquery.flot.resize.min.js"></script>
	<script src="/static/js/jquery.dataTables.min.js"></script>
	<!-- ace scripts -->
	<script src="/static/js/bootbox.min.js"></script>
	<script src="/static/js/ace-elements.min.js"></script>
	<script src="/static/js/ace.min.js"></script>

	<!-- inline scripts related to this page -->
	<script src="/static/js/highcharts.js"></script>
	<script type="text/javascript"> 
	function getchecktable(checkres,type)
	{
		 var chkdata='';
		 for ( var i in checkres) {
				var one = checkres[i];
				if(one['statuslevel']!=type)
					{continue;}
				 chkdata += ' <div ><h4 class="header     green"><i class="icon-globe"></i>IP:';
				 chkdata += one['ip'];
				 chkdata += '</h4><p><table class="table table-striped table-bordered table-hover"><tbody >';

				  chkdata += '<tr ><td class="col-sm-1">上一次检测时间</td><td>';
				  chkdata += '<a>'+one['lastcheckts']+'</a></td> ';
				  
				  chkdata += '<td class="col-sm-1">证书</td><td>';

				  chkdata += '<a href="/project/certdetail?id='+one['certinfo']['id']+'">查看详情</a></td></tr>';
				 
				 

				  chkdata += '<tr ><td class="col-sm-1">证书名称</td><td>';
				  chkdata += '<a>'+one['certinfo']['common_name']+'  ['+(one['hostname_validation']?'匹配]':'不匹配]')+'</a></td>';
				  chkdata += '<td class="col-sm-1">证书签名算法</td><td>';
				  chkdata += '<a>'+one['certinfo']['signature_algorithm']+'</a></td></tr>';
				  
				  
				  chkdata += '<tr ><td class="col-sm-1">签发者</td><td>';
				  chkdata += '<a>'+one['certinfo']['issuer_name']+'</a></td>';
				  chkdata += '<td class="col-sm-1">证书链完整性</td><td>';
				  tt=one['certinfo']['chain_order_valid']?'完整':'不完整'
				  chkdata += '<a>'+tt+'</a></td></tr>';
				  
				  chkdata += '<tr ><td class="col-sm-1">剩余时间</td><td>';
				  chkdata += '<a>'+one['certinfo']['expdate']+'天</a></td>';
				  chkdata += '<td class="col-sm-1">证书信任状态</td><td>';
				  tt=one['certinfo']['trusted']?'可信':'不可信'
				  chkdata += '<a>'+tt+'</a></td></tr>';
				  
				  chkdata += '<tr ><td class="col-sm-1">HeartBleed</td><td>';
				  chkdata += '<a>'+checkinfo[one['heartbleed']]+'</a></td>';
				  chkdata += '<td class="col-sm-1">CCS</td><td>';
				  chkdata += '<a>'+checkinfo[one['ccs']]+'</a></td></tr>';
				  
				  chkdata += '<tr><td class="col-sm-1">HSTS</td><td>';

				  chkdata += '<a>'+checkinfo[one['hsts']]+'</a></td>';
				  chkdata += '<td class="col-sm-1">Poodle</td><td>';
				  chkdata += '<a>'+checkinfo[one['poodle']]+'</a></td></tr>';

									
			      chkdata +='</tbody></table></p></div>';

			}
		 return chkdata;
	}
	
	
	function getprojects()
	{
		jQuery
		.getJSON(
				'/project/getprojectreport?id={{id}}',
				function(result) { 
					
					 $('#name').val(result['data']['name']);
					 $('#domain').val(result['data']['domain']);
					 $('#port').val(result['data']['port']);
					 $('#frequency').val(result['data']['check_frequency']);
					 $('#notify_name').val(result['data']['notify_rule_name']);
					 $('#ccs').attr("checked",result['data']['ccs_check']);
					 $('#hsts').attr("checked",result['data']['hsts_check']);
					 $('#heartbleed').attr("checked",result['data']['heartbleed_check']);
					 $('#poodle').attr("checked",result['data']['poodle_check']);
					 
					 checkres = result['data']['checkres'];

					 
					 var res=['任务加载中','检测中','正常','警告','发生错误','过期']
					 $('#status').val(res[result['data']['status']]+':'+result['data']['statusinfo']);
					 
					 
					 checkinfo=['未检测','正常','存在问题']
					 
					
					 $('#normal').html(getchecktable(checkres,0));
					 $('#warning').html(getchecktable(checkres,1));
					 $('#error').html(getchecktable(checkres,2));
					 $('#normal_title').html('正常'+result['data']['normal']);
					 $('#warning_title').html('警告'+result['data']['warning']);
					 $('#error_title').html('错误'+result['data']['error']);
					
				});

	};
	getprojects();
	</script>
	<div style="display: none">
	</div>
</body>
</html>

